const express = require('express');
const app = express();
const rateLimit = require('express-rate-limit');
const https = require('https');

const rateLimiter = rateLimit({
    windowMs: 15 * 60 * 1000,
    max: 5,
    message: 'Too many requests have been made from IP, please try again after an hour'
});

app.get('/test', rateLimiter, function (req, res){
    console.log("Received request...");
    var id = req.query.id;
    var url = 'https://postman-echo.com/get?test=' + id;
    console.log("Calling URL %s", url);
});

https.get(usr, (resp => {
    let data = '';

    resp.on('data', (chunk) => {
        data += chunk;
    });

    resp.on('end', () => {
        res.send(data);
    });

    }).on('error', (err) => {
        res.send(err.message);
    })
)

var server = app.listen(9091, function () {
    var port = server.address().port;
    console.log("Ambassador listening on port %s...", post)
})
